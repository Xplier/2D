<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Vertical Platform Climber</title>
    <style>
        body {
            margin: 0;
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            background: #333;
            overflow: hidden;
        }
        canvas {
            border: 2px solid white;
            touch-action: none; /* Disable pinch-zoom on mobile */
        }
        #controls {
            position: absolute;
            bottom: 20px;
            display: none; /* Initially hide controls */
        }
        #joystick {
            position: absolute;
            bottom: 20px;
            left: 20px;
            width: 100px;
            height: 100px;
            background: rgba(0, 0, 0, 0.5);
            border-radius: 50%;
            display: flex;
            justify-content: center;
            align-items: center;
        }
        #joystick .stick {
            width: 50px;
            height: 50px;
            background: rgba(255, 255, 255, 0.8);
            border-radius: 50%;
            position: absolute;
        }
    </style>
</head>
<body>
    <script>
        const canvas = document.createElement('canvas');
        const ctx = canvas.getContext('2d');
        document.body.appendChild(canvas);

        // Function to set canvas resolution dynamically
        function resizeCanvas() {
            canvas.width = window.innerWidth * 0.8;  // 80% of screen width
            canvas.height = window.innerHeight * 0.8;  // 80% of screen height
        }

        window.addEventListener('resize', resizeCanvas);
        resizeCanvas();

        // Detect mobile screen
        const isMobile = window.innerWidth < 768;

        // Show or hide mobile controls based on screen width
        if (isMobile) {
            document.getElementById('controls').style.display = 'flex';
        }

        class Player {
            constructor() {
                this.reset();
                this.size = 30;
                this.jumpForce = -15;
                this.maxSpeed = 8;
                this.standTimer = 3000;
                this.lastMoveTime = Date.now();
                this.standTimerVisible = false;
                this.standTimerDelay = 400; // 0.4 seconds before showing timer
            }

            reset() {
                this.x = canvas.width / 2;
                this.y = canvas.height - 100;
                this.velocityX = 0;
                this.velocityY = 0;
                this.isGrounded = false;
                this.score = 0;
                this.standTimer = 3000;
                this.lastMoveTime = Date.now();
                this.standTimerVisible = false;
            }

            draw() {
                ctx.beginPath();
                ctx.roundRect(this.x - this.size/2, this.y - this.size/2, 
                            this.size, this.size, 8);
                ctx.fillStyle = '#FF5722';
                ctx.fill();
                ctx.closePath();

                if (this.isGrounded && Math.abs(this.velocityX) < 0.1) {
                    const currentTime = Date.now();
                    const standingTime = currentTime - this.lastMoveTime;
                    
                    if (standingTime >= this.standTimerDelay) {
                        const timeLeft = Math.max(0, (this.standTimer - standingTime) / 1000).toFixed(1);
                        if (standingTime < this.standTimer) {
                            ctx.fillStyle = 'white';
                            ctx.font = '20px Arial';
                            ctx.fillText(timeLeft, this.x - 10, this.y - this.size);
                        }
                    }
                }
            }
        }

        class Platform {
            constructor(x, y, type = 'normal') {
                this.width = Math.random() * 80 + 100;
                this.height = 15;
                this.x = x;
                this.y = y;
                this.type = type;
                this.hasJumpPad = Math.random() < 0.15;
                this.spawnTime = Date.now();
                this.disappearTime = 700;
                this.alpha = 1;
            }

            update() {
                if (this.type === 'disappearing') {
                    const age = Date.now() - this.spawnTime;
                    if (age < this.disappearTime) {
                        this.alpha = 1 - (age / this.disappearTime);
                    } else {
                        this.alpha = 0;
                    }
                }
            }

            isActive() {
                return this.type === 'normal' || this.alpha > 0;
            }

            draw() {
                if (this.alpha <= 0) return;

                ctx.beginPath();
                ctx.roundRect(this.x - this.width/2, this.y, this.width, this.height, 5);
                ctx.fillStyle = this.type === 'normal' ? '#4CAF50' : `rgba(128, 128, 128, ${this.alpha})`;
                ctx.fill();
                ctx.closePath();

                if (this.hasJumpPad && this.type === 'normal') {
                    ctx.beginPath();
                    ctx.arc(this.x, this.y - 5, 8, 0, Math.PI * 2);
                    ctx.fillStyle = '#FFD700';
                    ctx.fill();
                    ctx.closePath();
                }
            }
        }

        const player = new Player();
        let platforms = [];
        let gameSpeed = 2;
        let highScore = 0;

        function initPlatforms() {
            platforms = [];
            platforms.push(new Platform(canvas.width/2, canvas.height - 50, 'normal'));
            for (let i = 0; i < 8; i++) {
                generatePlatform();
            }
        }

        function generatePlatform() {
            const minGap = 120;
            const maxGap = 170;
            const lastPlatform = platforms[platforms.length - 1];
            const y = lastPlatform.y - (Math.random() * (maxGap - minGap) + minGap);
            const minX = 80;
            const maxX = canvas.width - 80;
            const x = Math.random() * (maxX - minX) + minX;
            platforms.push(new Platform(x, y));
        }

        const keys = {
            left: false,
            right: false,
            jump: false
        };

        // Joystick handling variables
        let joystickCenter = { x: 0, y: 0 };
        let joystickStick = { x: 0, y: 0 };
        let joystickRadius = 40; // Radius of the joystick control area

        // Handle mobile touch events
        let touchStartX = 0;
        let touchStartY = 0;

        document.addEventListener('touchstart', (e) => {
            e.preventDefault();
            const touch = e.touches[0];
            touchStartX = touch.clientX;
            touchStartY = touch.clientY;

            // Start dragging joystick
            if (touchStartX < canvas.width / 3 && touchStartY > canvas.height / 2) {
                joystickCenter.x = touchStartX;
                joystickCenter.y = touchStartY;
                document.getElementById('joystick').style.display = 'block'; // Show joystick
            }
        });

        document.addEventListener('touchmove', (e) => {
            e.preventDefault();
            const touch = e.touches[0];
            const dx = touch.clientX - joystickCenter.x;
            const dy = touch.clientY - joystickCenter.y;
            const distance = Math.min(Math.sqrt(dx * dx + dy * dy), joystickRadius);

            joystickStick.x = distance * (dx / Math.sqrt(dx * dx + dy * dy));
            joystickStick.y = distance * (dy / Math.sqrt(dx * dx + dy * dy));

            // Set the velocity direction
            if (Math.abs(joystickStick.x) > 0.1) {
                keys.left = joystickStick.x < 0;
                keys.right = joystickStick.x > 0;
            }

            if (Math.abs(joystickStick.y) > 0.1) {
                keys.jump = joystickStick.y < 0;
            }
        });

        document.addEventListener('touchend', (e) => {
            e.preventDefault();
            keys.left = false;
            keys.right = false;
            keys.jump = false;
            document.getElementById('joystick').style.display = 'none'; // Hide joystick
        });

        // Game logic

        const gravity = 0.5;
        const friction = 0.8;
        const jumpPadForce = -20;

        function update() {
            if (keys.left && player.velocityX > -player.maxSpeed) {
                player.velocityX -= 0.5;
            }
            if (keys.right && player.velocityX < player.maxSpeed) {
                player.velocityX += 0.5;
            }
            if (!keys.left && !keys.right) {
                player.velocityX *= friction;
            }

            player.velocityY += gravity;

            if (keys.jump && player.isGrounded) {
                player.velocityY = player.jumpForce;
                player.isGrounded = false;
            }

            player.x += player.velocityX;
            player.y += player.velocityY;

            if (player.x < player.size/2) player.x = player.size/2;
            if (player.x > canvas.width - player.size/2) player.x = canvas.width - player.size/2;

            player.isGrounded = false;
            platforms.forEach(platform => {
                if (!platform.isActive()) return;

                if (player.x + player.size/2 > platform.x - platform.width/2 &&
                    player.x - player.size/2 < platform.x + platform.width/2 &&
                    player.y + player.size/2 > platform.y &&
                    player.y - player.size/2 < platform.y + platform.height) {
                    if (player.velocityY > 0) {
                        player.y = platform.y - player.size/2;
                        player.velocityY = 0;
                        player.isGrounded = true;
                    }
                }
            });

            platforms = platforms.filter(platform => platform.y < canvas.height + 100);

            if (player.y > canvas.height + player.size) {
                player.reset();
                initPlatforms();
            }
        }

        function render() {
            ctx.fillStyle = '#87CEEB';
            ctx.fillRect(0, 0, canvas.width, canvas.height);
            platforms.forEach(platform => platform.draw());
            player.draw();

            ctx.fillStyle = 'white';
            ctx.font = '20px Arial';
            ctx.fillText(`Score: ${Math.floor(player.score)}`, 10, 30);
            ctx.fillText(`High: ${Math.floor(highScore)}`, canvas.width - 120, 30);
        }

        function gameLoop() {
            update();
            render();
            requestAnimationFrame(gameLoop);
        }

        initPlatforms();
        gameLoop();
    </script>

    <!-- Joystick Container -->
    <div id="joystick">
        <div class="stick"></div>
    </div>
</body>
</html>
